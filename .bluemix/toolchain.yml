---
name: Microservices Demo
description: A ToolChain to end all toolchains. This is a really good sample with a bunch of good stuff in it, yada yada yada. Maybe we will write a sentence or two more about this stuff. Itâ€™s very cool.
version: 0.2
image: image.png
required:
 - catalog-api-repo
 - orders-api-repo
 - ui-repo

# Github repos
catalog-api-repo:
  service-id: github
  parameters:
    repo_name: "{{name}}-catalog-api"
    fork: skaegi/Microservices_CatalogAPI
    has_issues: false

orders-api-repo:
  service-id: github
  parameters:
    repo_name: "{{name}}-order-api"
    fork: skaegi/Microservices_OrdersAPI
    has_issues: false

ui-repo:
  service-id: github
  parameters:
    repo_name: "{{name}}-ui"
    fork: skaegi/Microservices_UI
    has_issues: true

# Pipelines
ui-build:
 service-id: pipeline
 parameters: 
   pipeline_yml: "${file:ui.pipeline.yml}" 
   env:
     REPO_URL: "{{ui-repo.parameters.repo-url}}"
     SAUCE_USER: "{{test.parameters.username}}"
     API_KEY: "{{test.parameters.key}}"
     APP_NAME: "{{deploy.parameters.ui-app-name}}"
     DEV_SPACE_NAME: "{{deploy.parameters.dev-space}}"
     DEV_ORG_NAME: "{{deploy.parameters.dev-organization}}"
     DEV_REGION_NAME: "{{deploy.parameters.dev-region}}"
     QA_SPACE_NAME: "{{deploy.parameters.qa-space}}"
     QA_ORG_NAME: "{{deploy.parameters.qa-organization}}"
     QA_REGION_NAME: "{{deploy.parameters.qa-region}}"
     PROD_SPACE_NAME: "{{deploy.parameters.prod-space}"
     PROD_ORG_NAME: "{{deploy.parameters.prod-organization}}"
     PROD_REGION_NAME: "{{deploy.parameters.prod-region}}"

catalog-api-build:
 service-id: pipeline
 parameters: 
   pipeline_yml: "${file:catalog-api.pipeline.yml}"
   env:
     REPO_URL: "{{catalog-api-repo.parameters.repo-url}}"
     APP_NAME: "{{deploy.parameters.catalog-app-name}}"
     DEV_SPACE_NAME: "{{deploy.parameters.dev-space}}"
     DEV_ORG_NAME: "{{deploy.parameters.dev-organization}}"
     DEV_REGION_NAME: "{{deploy.parameters.dev-region}}"
     QA_SPACE_NAME: "{{deploy.parameters.qa-space}}"
     QA_ORG_NAME: "{{deploy.parameters.qa-organization}}"
     QA_REGION_NAME: "{{deploy.parameters.qa-region}}"
     PROD_SPACE_NAME: "{{deploy.parameters.prod-space}}"
     PROD_ORG_NAME: "{{deploy.parameters.prod-organization}}"
     PROD_REGION_NAME: "{{deploy.parameters.prod-region}}"

orders-api-build:
 service-id: pipeline
 parameters: 
   pipeline_yml: "${file:order-api.pipeline.yml}"
   env:
     REPO_URL: "{{orders-api-repo.parameters.repo-url}}"
     APP_NAME: "{{deploy.parameters.orders-app-name}}"
     DEV_SPACE_NAME: "{{deploy.parameters.dev-space}}"
     DEV_ORG_NAME: "{{deploy.parameters.dev-organization}}"
     DEV_REGION_NAME: "{{deploy.parameters.dev-region}}"
     QA_SPACE_NAME: "{{deploy.parameters.qa-space}}"
     QA_ORG_NAME: "{{deploy.parameters.qa-organization}}"
     QA_REGION_NAME: "{{deploy.parameters.qa-region}}"
     PROD_SPACE_NAME: "{{deploy.parameters.prod-space}}"
     PROD_ORG_NAME: "{{deploy.parameters.prod-organization}}"
     PROD_REGION_NAME: "{{deploy.parameters.prod-region}}"

#Slack
messaging:
  service-id: slack
  <<: !include
    filename: slack.yml

#Sauce Laps
test:
  service-id: saucelabs
  <<: !include
    filename: saucelabs.yml

#Deployment
deploy:
  service-category-id: pipeline
  schema: deploy.json
  parameters:
    dev-space: dev
    qa-space: test
    prod-space: prod
